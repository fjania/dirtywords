<!DOCTYPE html>
<html>
 <head>
  <meta charset="UTF-8">
  <title>Dirty Words</title>
  <style>
    * {
        box-sizing: border-box;
    }
    body {
        font-family: monospace;
    }

    #board {
        background: #4462B2;
        width: 1210px;
        height: 610px;
        padding: 5px;
        margin: 10px auto;
    }
    #board:after {
        content: '';
        clear: both;
        display: block;
    }
    #board .word {
        cursor: pointer;
        font-weight: bold;
        font-size: 2em;
        border: 5px solid;
        border-color: #ffddaa;
        background: #ffddaa;
        float: left;
        width: 190px;
        height: 90px;
        margin: 5px;
        border-radius: 10px;
        line-height: 90px;
        text-align: center;
        vertical-align: middle;
    }
    #board .word.real.revealed {
        background: #aaddaa;
        border-color: #aaddaa;
    }
    #board .word.fake.revealed {
        background: #ffaaaa;
        border-color: #ffaaaa;
    }
    #board .word.revealed {
        opacity: 0.5;
    }
    #board .word.real.revealed {
        opacity: 0.75;
    }
    #board .word.revealed.selected {
        opacity: 1.0;
    }
    #board .word.real.selected{
        border-color: #0FC851;
    }
    #board .word.fake.selected{
        border-color: #C80F1D;
    }
    #definition {
        background: #aaddff;
        width: 1210px;
        padding: 10px;
        margin: 10px auto;
        min-height: 35px;
        font-size: 1.25em;
    }
    #definition .word {
        font-weight: bold;
    }
    #definition .pos {
        font-style: italic;
    }
  </style>
 </head>
 <body>
    <div id='board'></div>
    <div id='definition'></div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script>
    var loader;
    var wordCount = 36;
    var $board = $('#board');
    var $definition = $('#definition');
    var realWordsHidden = 0;
    var words = {};
    var o;

    function drawBoard(wordList){
        $board.empty();
        wordList.forEach(function(e,i){
            words[e.w] = e;
            var classes = ['word'];
            if (e.d) {
                classes.push('real');
                realWordsHidden += 1;
            } else {
                classes.push('fake');
            }
            o = [
                "<div class='" + classes.join(' ') + "' data-word='"+e.w+"'>",
                e.w,
                "</div>",
            ];
            $board.append(o.join(''));
        });
    }

    function garbageWord(len){
        var text = "";
        var possible = "abcdefghijklmnopqrstuvwxyz";

        for( var i=0; i < len; i++ )
            text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
    }

    function drawLoadingBoard(){
        var wl = [];
        for (var i = 0; i < wordCount; i++){
            wl.push({w: garbageWord(7)});
        }
        drawBoard(wl);
    }

    function loadBoard(){
        $.ajax({
            url: '/api/board'
        }).done(function(data){
            clearInterval(loader);
            drawBoard(data.board);
        })
    }

    function revealAnswers(win){
        $('.word').addClass('revealed');
    }

    function init(){
        loader = setInterval(drawLoadingBoard, 100);
        setTimeout(loadBoard, 500);

        $board.on('click', '.word', function(){
            var $t = $(this);
            var selected = 'selected';
            var revealed = 'revealed';
            var word = $(this).data('word');

            if ($t.hasClass('real')){
                console.log(word, words);
                var e = words[word];
                o = [
                    "<span class='word'>",
                    e.w,
                    "</span>",
                    " - (<span class='pos'>",
                    e.p,
                    "</span>)",
                    "<span class='definition'> : ",
                    e.d,
                    "</span>",
                ];
                $definition.empty();
                $definition.append(o.join(''));
            }
            if (!$t.hasClass(selected) && !$t.hasClass(revealed)){
                $t.addClass('selected');
                if ($t.hasClass('real')){
                    realWordsHidden += -1;
                    if (realWordsHidden < 1) {
                        revealAnswers(true);
                    }
                } else {
                    revealAnswers();
                }
            }
        })
    }

    $(init);
  </script>
 </body>
</html>
